const fs = require("fs");
const path = require("path");

const Bench = require("benchmark");
const {
  compileFastValidator,
  Type,
  createValidator,
  ensureDataType,
} = require("../dist/cjs/index.cjs");

const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

const runSuiteForSample = (name, sample, data) => {
  const validate = createValidator(sample);
  const fastValidate = compileFastValidator(sample);

  console.log(separator + "\n");
  return new Promise((r) => {
    const suite = new Bench.Suite(
      `\u001b[1m\u001b[37mValidators benchmark, sample: \u001b[33m${name}\u001b[0m`,
    );
    suite
      .add("validate", function() {
        validate(data);
      })
      .add("fastValidate", function() {
        fastValidate(data);
      })
      .on("start", function() {
        console.log("Running Suite: " + this.name);
      })
      .on("error", function(e) {
        console.log("Error in Suite: " + this.name, e);
      })
      .on("abort", function(e) {
        console.log("Aborting Suite: " + this.name, e);
      })
      .on("complete", function() {
        const fastest = this.filter("fastest");

        console.log("");

        for (let j = 0; j < this.length; j++) {
          console.log(
            "   ",
            this[j].toString(),
            "\u001b[94m"
              + ((this[j].hz / fastest[0].hz) * 100).toFixed(2)
              + "%\u001b[0m",
          );
        }

        console.log(
          "\n\u001b[1m\u001b[37mFastest is \u001b[92m" + fastest.map("name"),
          "\u001b[0m",
        );
        r();
      })
      // run async
      .run({ async: true });
  }).then(() => sleep(5000));
};

const separator = "\u001b[35m" + "-".repeat(65) + "\u001b[0m";

const micro = async () => {
  await runSuiteForSample("micro - valid 1", Type.String, "asdasd");
  await runSuiteForSample("micro - valid 2", Type.Number, 42);

  await runSuiteForSample("micro - invalid 1", Type.String, 42);
  await runSuiteForSample("micro - invalid 2", Type.Number, "asdasd");
};

const mini = async () => {
  const miniSample = Type.RecordOf({
    foo: Type.String,
    bar: Type.Number,
  });

  const validData = {
    foo: "lorem ipsum dolor sit amet consectetur adipiscing elit",
    bar: 42,
  };

  const invalidData = {
    foo: "abc",
    bar: "def",
  };

  ensureDataType(miniSample, validData);

  await runSuiteForSample("mini - valid", miniSample, validData);
  await runSuiteForSample("mini - invalid", miniSample, invalidData);
};

const small = async () => {
  const smallSample = Type.RecordOf({
    foo: Type.String,
    bar: Type.Number,
    baz: Type.Boolean,
    qux: Type.ArrayOf(Type.String),
    quux: Type.Null,
  });

  const validData = {
    foo: "lorem ipsum dolor sit amet consectetur adipiscing elit",
    bar: 42,
    baz: true,
    qux: ["lorem", "ipsum", "dolor", "sit", "amet", "consectetur"],
    quux: null,
  };

  const invalidData1 = {
    foo: "lorem ipsum dolor sit amet consectetur adipiscing elit",
    bar: 42,
    baz: true,
    qux: ["lorem", "ipsum", "dolor", 1, "amet", "consectetur"],
    quux: null,
  };

  const invalidData2 = {
    foo: "lorem ipsum dolor sit amet consectetur adipiscing elit",
    bar: 42,
    baz: "true",
    qux: ["lorem", "ipsum", "dolor", "sit", "amet", "consectetur"],
    quux: null,
  };

  ensureDataType(smallSample, validData);

  await runSuiteForSample("small - valid", smallSample, validData);
  await runSuiteForSample("small - invalid 1", smallSample, invalidData1);
  await runSuiteForSample("small - invalid 2", smallSample, invalidData2);
};

const medium = async () => {
  const mediumSample = Type.RecordOf({
    foo: Type.String,
    bar: Type.Number,
    baz: Type.Boolean,
    qux: Type.ArrayOf(
      Type.RecordOf({
        quux: Type.String,
        quuz: Type.Number,
        corge: Type.Boolean,
        grault: Type.ArrayOf(Type.String),
        garply: Type.Null,
      }),
    ),
    waldo: Type.Null,
  });

  const validData = {
    foo: "lorem ipsum dolor sit amet consectetur adipiscing elit",
    bar: 42,
    baz: true,
    qux: [
      {
        quux: "lorem ipsum dolor sit amet consectetur adipiscing elit",
        quuz: 42,
        corge: true,
        grault: [
          "lorem",
          "ipsum",
          "dolor",
          "sit",
          "amet",
          "consectetur",
          "adipiscing",
          "elit",
        ],
        garply: null,
      },
      {
        quux: "lorem ipsum dolor sit amet consectetur adipiscing elit",
        quuz: 42,
        corge: true,
        grault: [
          "lorem",
          "ipsum",
          "dolor",
          "sit",
          "amet",
          "consectetur",
          "adipiscing",
          "elit",
        ],
        garply: null,
      },
      {
        quux: "lorem ipsum dolor sit amet consectetur adipiscing elit",
        quuz: 42,
        corge: true,
        grault: [
          "lorem",
          "ipsum",
          "dolor",
          "sit",
          "amet",
          "consectetur",
          "adipiscing",
          "elit",
        ],
        garply: null,
      },
    ],
    waldo: null,
  };

  const invalidData1 = {
    foo: "lorem ipsum dolor sit amet consectetur adipiscing elit",
    bar: 42,
    baz: true,
    qux: [
      {
        quux: "lorem ipsum dolor sit amet consectetur adipiscing elit",
        quuz: 42,
        corge: true,
        grault: [
          "lorem",
          "ipsum",
          "dolor",
          "sit",
          "amet",
          "consectetur",
          "adipiscing",
          "elit",
        ],
        garply: null,
      },
      {
        quux: "lorem ipsum dolor sit amet consectetur adipiscing elit",
        quuz: 42,
        corge: true,
        grault: [
          "lorem",
          "ipsum",
          "dolor",
          "sit",
          "amet",
          "consectetur",
          "adipiscing",
          "elit",
        ],
        garply: null,
      },
      {
        quux: "lorem ipsum dolor sit amet consectetur adipiscing elit",
        quuz: 42,
        corge: true,
        grault: [
          "lorem",
          "ipsum",
          "dolor",
          "sit",
          "amet",
          "consectetur",
          "adipiscing",
          "elit",
        ],
        garply: null,
      },
    ],
    waldo: null,
  };

  ensureDataType(mediumSample, validData);

  await runSuiteForSample("medium - valid", mediumSample, validData);
  await runSuiteForSample("medium - invalid 1", mediumSample, invalidData1);
};

const large = async () => {
  const largeSample = Type.RecordOf({
    foo: Type.String,
    bar: Type.Number,
    baz: Type.Boolean,
    qux: Type.ArrayOf(
      Type.Circular((self) =>
        Type.RecordOf({
          quux: Type.StringInt,
          quuz: Type.Int,
          corge: Type.Boolean,
          grault: Type.ArrayOf(
            Type.RecordOf({
              garply: Type.String,
              waldo: Type.StringNumeral,
              fred: Type.Boolean,
              plugh: Type.ArrayOf(Type.String, Type.Number, Type.Boolean),
              xyzzy: Type.Null,
            }),
          ),
          thud: Type.Function,
          paparapr: Type.Dict(Type.String, Type.Number),
          regexp: Type.InstanceOf(RegExp),
          entries: Type.ArrayOf(
            Type.Tuple(
              Type.String,
              Type.RecordOf({
                value: Type.String,
                done: Type.Boolean,
              }),
            ),
          ),
          circ: { type: self, required: false },
        })
      ),
    ),
    wibble: Type.Null,
  });

  const validData = {
    foo: "lorem ipsum dolor sit amet consectetur adipiscing elit",
    bar: 42,
    baz: true,
    qux: [
      {
        quux: "1234",
        quuz: 42,
        corge: true,
        grault: [
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
        ],
        thud: () => {},
        paparapr: {
          foo: 42,
          bar: 421,
          baz: 4132,
          qux: 42352,
          quux: 13442,
          quuz: 42.123,
          corge: 0.42,
          grault: 42,
          garply: 42,
          waldo: 42,
          fred: 42,
          plugh: 42,
          xyzzy: 42,
          thud: 42,
          paparapr: 42,
          regexp: 42,
          entries: 42,
          circ: 42,
        },
        regexp: /foo/,
        entries: [
          ["foo", { value: "bar", done: false }],
          ["bar", { value: "baz", done: false }],
          ["baz", { value: "qux", done: false }],
          ["qux", { value: "quux", done: false }],
          ["quux", { value: "quuz", done: false }],
        ],
        circ: {
          quux: "012312342346545675686796123123523465",
          quuz: 42,
          corge: true,
          grault: [
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
          ],
          thud: () => {},
          paparapr: {
            foo: 42,
            bar: 42,
            baz: 42,
            qux: 42,
            quux: 42,
            quuz: 42,
            corge: 42,
            grault: 42,
            garply: 42,
          },
          regexp: /foo/,
          entries: [
            ["foo", { value: "bar", done: false }],
            ["bar", { value: "baz", done: false }],
            ["baz", { value: "qux", done: false }],
            ["qux", { value: "quux", done: false }],
            ["quux", { value: "quuz", done: false }],
          ],
        },
      },
      {
        quux: "1234",
        quuz: 42,
        corge: true,
        grault: [
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
        ],
        thud: () => {},
        paparapr: {
          foo: 42,
          bar: 421,
          baz: 4132,
          qux: 42352,
          quux: 13442,
          quuz: 42.123,
          corge: 0.42,
          grault: 42,
          garply: 42,
          waldo: 42,
          fred: 42,
          plugh: 42,
          xyzzy: 42,
          thud: 42,
          paparapr: 42,
          regexp: 42,
          entries: 42,
          circ: 42,
        },
        regexp: /foo/,
        entries: [
          ["foo", { value: "bar", done: false }],
          ["bar", { value: "baz", done: false }],
          ["baz", { value: "qux", done: false }],
          ["qux", { value: "quux", done: false }],
          ["quux", { value: "quuz", done: false }],
        ],
        circ: {
          quux: "01231235234",
          quuz: 42,
          corge: true,
          grault: [
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
          ],
          thud: () => {},
          paparapr: {
            foo: 42,
            bar: 42,
            baz: 42,
            qux: 42,
            quux: 42,
            quuz: 42,
            corge: 42,
            grault: 42,
            garply: 42,
          },
          regexp: /foo/,
          entries: [
            ["foo", { value: "bar", done: false }],
            ["bar", { value: "baz", done: false }],
            ["baz", { value: "qux", done: false }],
            ["qux", { value: "quux", done: false }],
            ["quux", { value: "quuz", done: false }],
          ],
        },
      },
      {
        quux: "1234",
        quuz: 42,
        corge: true,
        grault: [
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
        ],
        thud: () => {},
        paparapr: {
          foo: 42,
          bar: 421,
          baz: 4132,
          qux: 42352,
          quux: 13442,
          quuz: 42.123,
          corge: 0.42,
          grault: 42,
          garply: 42,
          waldo: 42,
          fred: 42,
          plugh: 42,
          xyzzy: 42,
          thud: 42,
          paparapr: 42,
          regexp: 42,
          entries: 42,
          circ: 42,
        },
        regexp: /foo/,
        entries: [
          ["foo", { value: "bar", done: false }],
          ["bar", { value: "baz", done: false }],
          ["baz", { value: "qux", done: false }],
          ["qux", { value: "quux", done: false }],
          ["quux", { value: "quuz", done: false }],
        ],
        circ: {
          quux: "12",
          quuz: 42,
          corge: true,
          grault: [
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
          ],
          thud: () => {},
          paparapr: {
            foo: 42,
            bar: 42,
            baz: 42,
            qux: 42,
            quux: 42,
            quuz: 42,
            corge: 42,
            grault: 42,
            garply: 42,
          },
          regexp: /foo/,
          entries: [
            ["foo", { value: "bar", done: false }],
            ["bar", { value: "baz", done: false }],
            ["baz", { value: "qux", done: false }],
            ["qux", { value: "quux", done: false }],
            ["quux", { value: "quuz", done: false }],
          ],
        },
      },
    ],
    wibble: null,
  };

  const invalidData1 = {
    foo: "lorem ipsum dolor sit amet consectetur adipiscing elit",
    bar: 42,
    baz: true,
    qux: [
      {
        quux: "1234",
        quuz: 42,
        corge: true,
        grault: [
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: 42,
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
        ],
        thud: () => {},
        paparapr: {
          foo: 42,
          bar: 421,
          baz: 4132,
          qux: 42352,
          quux: 13442,
          quuz: 42.123,
          corge: 0.42,
          grault: 42,
          garply: 42,
          waldo: 42,
          fred: 42,
          plugh: 42,
          xyzzy: 42,
          thud: 42,
          paparapr: 42,
          regexp: 42,
          entries: 42,
          circ: 42,
        },
        regexp: /foo/,
        entries: [
          ["foo", { value: "bar", done: false }],
          ["bar", { value: "baz", done: false }],
          ["baz", { value: "qux", done: false }],
          ["qux", { value: "quux", done: false }],
          ["quux", { value: "quuz", done: false }],
        ],
        circ: {
          quux: "0",
          quuz: 42,
          corge: true,
          grault: [
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
          ],
          thud: () => {},
          paparapr: {
            foo: 42,
            bar: 42,
            baz: 42,
            qux: 42,
            quux: 42,
            quuz: 42,
            corge: 42,
            grault: 42,
            garply: 42,
          },
          regexp: /foo/,
          entries: [
            ["foo", { value: "bar", done: false }],
            ["bar", { value: "baz", done: false }],
            ["baz", { value: "qux", done: false }],
            ["qux", { value: "quux", done: false }],
            ["quux", { value: "quuz", done: false }],
          ],
        },
      },
      {
        quux: "1234",
        quuz: 42,
        corge: true,
        grault: [
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
        ],
        thud: () => {},
        paparapr: {
          foo: 42,
          bar: 421,
          baz: 4132,
          qux: 42352,
          quux: 13442,
          quuz: 42.123,
          corge: 0.42,
          grault: 42,
          garply: 42,
          waldo: 42,
          fred: 42,
          plugh: 42,
          xyzzy: 42,
          thud: 42,
          paparapr: 42,
          regexp: 42,
          entries: 42,
          circ: 42,
        },
        regexp: /foo/,
        entries: [
          ["foo", { value: "bar", done: false }],
          ["bar", { value: "baz", done: false }],
          ["baz", { value: "qux", done: false }],
          ["qux", { value: "quux", done: false }],
          ["quux", { value: "quuz", done: false }],
        ],
        circ: {
          quux: "1",
          quuz: 42,
          corge: true,
          grault: [
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
          ],
          thud: () => {},
          paparapr: {
            foo: 42,
            bar: 42,
            baz: 42,
            qux: 42,
            quux: 42,
            quuz: 42,
            corge: 42,
            grault: 42,
            garply: 42,
          },
          regexp: /foo/,
          entries: [
            ["foo", { value: "bar", done: false }],
            ["bar", { value: "baz", done: false }],
            ["baz", { value: "qux", done: false }],
            ["qux", { value: "quux", done: false }],
            ["quux", { value: "quuz", done: false }],
          ],
        },
      },
      {
        quux: "1234",
        quuz: 42,
        corge: true,
        grault: [
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
        ],
        thud: () => {},
        paparapr: {
          foo: 42,
          bar: 421,
          baz: 4132,
          qux: 42352,
          quux: 13442,
          quuz: 42.123,
          corge: 0.42,
          grault: 42,
          garply: 42,
          waldo: 42,
          fred: 42,
          plugh: 42,
          xyzzy: 42,
          thud: 42,
          paparapr: 42,
          regexp: 42,
          entries: 42,
          circ: 42,
        },
        regexp: /foo/,
        entries: [
          ["foo", { value: "bar", done: false }],
          ["bar", { value: "baz", done: false }],
          ["baz", { value: "qux", done: false }],
          ["qux", { value: "quux", done: false }],
          ["quux", { value: "quuz", done: false }],
        ],
        circ: {
          quux: "1",
          quuz: 42,
          corge: true,
          grault: [
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
          ],
          thud: () => {},
          paparapr: {
            foo: 42,
            bar: 42,
            baz: 42,
            qux: 42,
            quux: 42,
            quuz: 42,
            corge: 42,
            grault: 42,
            garply: 42,
          },
          regexp: /foo/,
          entries: [
            ["foo", { value: "bar", done: false }],
            ["bar", { value: "baz", done: false }],
            ["baz", { value: "qux", done: false }],
            ["qux", { value: "quux", done: false }],
            ["quux", { value: "quuz", done: false }],
          ],
        },
      },
    ],
    wibble: null,
  };

  const invalidData2 = {
    foo: "lorem ipsum dolor sit amet consectetur adipiscing elit",
    bar: 42,
    baz: true,
    qux: [
      {
        quux: "1234",
        quuz: 42,
        corge: true,
        grault: [
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: 42,
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
        ],
        thud: () => {},
        paparapr: {
          foo: 42,
          bar: 421,
          baz: 4132,
          qux: 42352,
          quux: 13442,
          quuz: 42.123,
          corge: 0.42,
          grault: 42,
          garply: 42,
          waldo: 42,
          fred: 42,
          plugh: 42,
          xyzzy: 42,
          thud: 42,
          paparapr: 42,
          regexp: 42,
          entries: 42,
          circ: 42,
        },
        regexp: /foo/,
        entries: [
          ["foo", { value: "bar", done: false }],
          ["bar", { value: "baz", done: false }],
          ["baz", { value: "qux", done: false }],
          ["qux", { value: "quux", done: false }],
          ["quux", { value: "quuz", done: false }],
        ],
        circ: {
          quux: "0",
          quuz: 42,
          corge: true,
          grault: [
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
          ],
          thud: () => {},
          paparapr: {
            foo: 42,
            bar: 42,
            baz: 42,
            qux: 42,
            quux: 42,
            quuz: 42,
            corge: 42,
            grault: 42,
            garply: 42,
          },
          regexp: /foo/,
          entries: [
            ["foo", { value: "bar", done: false }],
            ["bar", { value: "baz", done: false }],
            ["baz", { value: "qux", done: false }],
            ["qux", { value: "quux", done: false }],
            ["quux", { value: "quuz", done: false }],
          ],
        },
      },
      {
        quux: "1234",
        quuz: 42,
        corge: true,
        grault: [
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
        ],
        thud: () => {},
        paparapr: {
          foo: 42,
          bar: 421,
          baz: 4132,
          qux: 42352,
          quux: 13442,
          quuz: 42.123,
          corge: 0.42,
          grault: 42,
          garply: 42,
          waldo: 42,
          fred: 42,
          plugh: 42,
          xyzzy: 42,
          thud: 42,
          paparapr: 42,
          regexp: 42,
          entries: 42,
          circ: 42,
        },
        regexp: /foo/,
        entries: [
          ["foo", { value: "bar", done: false }],
          ["bar", { value: "baz", done: false }],
          ["baz", { value: "qux", done: false }],
          ["qux", { value: "quux", done: false }],
          ["quux", { value: "quuz", done: false }],
        ],
        circ: {
          quux: "9567567",
          quuz: 42,
          corge: true,
          grault: [
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
          ],
          thud: () => {},
          paparapr: {
            foo: 42,
            bar: 42,
            baz: 42,
            qux: 42,
            quux: 42,
            quuz: 42,
            corge: 42,
            grault: 42,
            garply: 42,
          },
          regexp: /foo/,
          entries: [
            ["foo", { value: "bar", done: false }],
            ["bar", { value: "baz", done: false }],
            ["baz", { value: "qux", done: false }],
            ["qux", { value: "quux", done: false }],
            ["quux", { value: "quuz", done: false }],
          ],
        },
      },
      {
        quux: "1234",
        quuz: 42,
        corge: true,
        grault: [
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
          {
            garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
            waldo: "42",
            fred: true,
            plugh: [
              "lorem",
              "ipsum",
              2,
              "dolor",
              true,
              "sit",
              false,
              "amet",
              123.123,
              "consectetur",
              "adipiscing",
              "elit",
              0.111,
            ],
            xyzzy: null,
          },
        ],
        thud: () => {},
        paparapr: {
          foo: 42,
          bar: 421,
          baz: 4132,
          qux: 42352,
          quux: 13442,
          quuz: 42.123,
          corge: 0.42,
          grault: 42,
          garply: 42,
          waldo: 42,
          fred: 42,
          plugh: 42,
          xyzzy: 42,
          thud: 42,
          paparapr: 42,
          regexp: 42,
          entries: 42,
          circ: 42,
        },
        regexp: /foo/,
        entries: [
          ["foo", { value: "bar", done: false }],
          ["bar", { value: "baz", done: false }],
          ["baz", { value: "qux", done: false }],
          ["qux", { value: "quux", done: false }],
          ["quux", { value: "quuz", done: false }],
        ],
        circ: {
          quux: "0",
          quuz: 42,
          corge: true,
          grault: [
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
            {
              garply: "lorem ipsum dolor sit amet consectetur adipiscing elit",
              waldo: "42",
              fred: true,
              plugh: [
                "lorem",
                "ipsum",
                2,
                "dolor",
                true,
                "sit",
                false,
                "amet",
                123.123,
                "consectetur",
                "adipiscing",
                "elit",
                0.111,
              ],
              xyzzy: null,
            },
          ],
          thud: () => {},
          paparapr: {
            foo: 42,
            bar: 42,
            baz: 42,
            qux: 42,
            quux: 42,
            quuz: 42,
            corge: 42,
            grault: 42,
            garply: 42,
          },
          regexp: /foo/,
          entries: [
            ["foo", { value: "bar", done: false }],
            ["bar", { value: "baz", done: false }],
            ["baz", { value: "qux", done: false }],
            ["qux", { value: "quux", done: 1 }],
            ["quux", { value: "quuz", done: false }],
          ],
        },
      },
    ],
    wibble: null,
  };

  ensureDataType(largeSample, validData);

  await runSuiteForSample("large - valid", largeSample, validData);
  await runSuiteForSample("large - invalid 1", largeSample, invalidData1);
  await runSuiteForSample("large - invalid 2", largeSample, invalidData2);
};

const deeplyNestedRecord = async () => {
  const sample = Type.RecordOf({
    foo: Type.String,
    bar: Type.Number,
    baz: Type.Boolean,
    qux: Type.StringNumeral,
    quux: Type.StringInt,
    quuz: Type.OneOf(Type.Literal("a"), Type.Literal("b"), Type.Literal("c")),
    corge: Type.Int,
    grault: Type.RecordOf({
      foo: Type.String,
      bar: Type.Number,
      baz: Type.Boolean,
      qux: Type.StringNumeral,
      quux: Type.StringInt,
      quuz: Type.OneOf(Type.Literal("a"), Type.Literal("b"), Type.Literal("c")),
      corge: Type.Int,
      grault: Type.RecordOf({
        foo: Type.String,
        bar: Type.Number,
        baz: Type.Boolean,
        qux: Type.StringNumeral,
        quux: Type.StringInt,
        quuz: Type.OneOf(
          Type.Literal("a"),
          Type.Literal("b"),
          Type.Literal("c"),
        ),
        corge: Type.Int,
        grault: Type.RecordOf({
          foo: Type.String,
          bar: Type.Number,
          baz: Type.Boolean,
          qux: Type.StringNumeral,
          quux: Type.StringInt,
          quuz: Type.OneOf(
            Type.Literal("a"),
            Type.Literal("b"),
            Type.Literal("c"),
          ),
          corge: Type.Int,
          grault: Type.RecordOf({
            foo: Type.String,
            bar: Type.Number,
            baz: Type.Boolean,
            qux: Type.StringNumeral,
            quux: Type.StringInt,
            quuz: Type.OneOf(
              Type.Literal("a"),
              Type.Literal("b"),
              Type.Literal("c"),
            ),
            corge: Type.Int,
            grault: Type.RecordOf({
              foo: Type.String,
              bar: Type.Number,
              baz: Type.Boolean,
              qux: Type.StringNumeral,
              quux: Type.StringInt,
              quuz: Type.OneOf(
                Type.Literal("a"),
                Type.Literal("b"),
                Type.Literal("c"),
              ),
              corge: Type.Int,
              grault: Type.RecordOf({
                foo: Type.String,
                bar: Type.Number,
                baz: Type.Boolean,
                qux: Type.StringNumeral,
                quux: Type.StringInt,
                quuz: Type.OneOf(
                  Type.Literal("a"),
                  Type.Literal("b"),
                  Type.Literal("c"),
                ),
                corge: Type.Int,
              }),
            }),
          }),
        }),
      }),
    }),
  });

  const validData = {
    foo: "cv39487nb50983457nv8 3n7589vn459873cm4",
    bar: -12445,
    baz: true,
    qux: "123.135235",
    quux: "1230000",
    quuz: "a",
    corge: 123,
    grault: {
      foo: "dflwpe",
      bar: 0o777,
      baz: false,
      qux: "12",
      quux: "0",
      quuz: "b",
      corge: 0,
      grault: {
        foo: "",
        bar: 0,
        baz: true,
        qux: ".21398167123",
        quux: "1111111111111111111111",
        quuz: "c",
        corge: -123,
        grault: {
          foo: "dflwpe",
          bar: 0o777,
          baz: false,
          qux: "12",
          quux: "0",
          quuz: "b",
          corge: 0,
          grault: {
            foo: "",
            bar: 0,
            baz: true,
            qux: ".21398167123",
            quux: "1111111111111111111111",
            quuz: "c",
            corge: -123,
            grault: {
              foo: "",
              bar: 0,
              baz: true,
              qux: ".21398167123",
              quux: "1111111111111111111111",
              quuz: "c",
              corge: -123,
              grault: {
                foo: "",
                bar: 0,
                baz: true,
                qux: ".21398167123",
                quux: "1111111111111111111111",
                quuz: "c",
                corge: -123,
              },
            },
          },
        },
      },
    },
  };

  const invalidData1 = {
    foo: "cv39487nb50983457nv8 3n7589vn459873cm4",
    bar: -12445,
    baz: true,
    qux: "123.135235",
    quux: "1230000",
    quuz: "a",
    corge: 123,
    grault: {
      foo: "dflwpe",
      bar: "0o777",
      baz: false,
      qux: "12",
      quux: "0",
      quuz: "b",
      corge: 0,
      grault: {
        foo: "",
        bar: 0,
        baz: true,
        qux: ".21398167123",
        quux: "1111111111111111111111",
        quuz: "c",
        corge: -123,
        grault: {
          foo: "dflwpe",
          bar: 0o777,
          baz: false,
          qux: "12",
          quux: "0",
          quuz: "b",
          corge: 0,
          grault: {
            foo: "",
            bar: 0,
            baz: true,
            qux: ".21398167123",
            quux: "1111111111111111111111",
            quuz: "c",
            corge: -123,
            grault: {
              foo: "",
              bar: 0,
              baz: true,
              qux: ".21398167123",
              quux: "1111111111111111111111",
              quuz: "c",
              corge: -123,
              grault: {},
            },
          },
        },
      },
    },
  };

  const invalidData2 = {
    foo: "cv39487nb50983457nv8 3n7589vn459873cm4",
    bar: -12445,
    baz: true,
    qux: "123.135235",
    quux: "1230000",
    quuz: "a",
    corge: 123,
    grault: {
      foo: "dflwpe",
      bar: 0o777,
      baz: false,
      qux: "12",
      quux: "0",
      quuz: "b",
      corge: 0,
      grault: {
        foo: "",
        bar: 0,
        baz: true,
        qux: ".21398167123",
        quux: "1111111111111111111111",
        quuz: "c",
        corge: -123,
        grault: {
          foo: "dflwpe",
          bar: 0o777,
          baz: false,
          qux: "12",
          quux: "0",
          quuz: "b",
          corge: 0,
          grault: {
            foo: "",
            bar: 0,
            baz: true,
            qux: ".21398167123",
            quux: "1111111111111111111111",
            quuz: "c",
            corge: -123,
            grault: {
              foo: "",
              bar: 0,
              baz: true,
              qux: ".21398167123",
              quux: "1111111111111111111111",
              quuz: "c",
              corge: -123.1,
            },
          },
        },
      },
    },
  };

  ensureDataType(sample, validData);

  await runSuiteForSample("deeply nested record - valid", sample, validData);
  await runSuiteForSample(
    "deeply nested record - invalid 1",
    sample,
    invalidData1,
  );
  await runSuiteForSample(
    "deeply nested record - invalid 2",
    sample,
    invalidData2,
  );
};

async function main() {
  // await micro();
  // await mini();
  // await small();
  // await medium();
  await deeplyNestedRecord();
  // await large();
}

main();
